[supervisord]
nodaemon=true
minfds=1024
minprocs=200

; --------------------------------------------------------------------------
; POSTGRES (Server only, inicialización hecha en start.sh)
; --------------------------------------------------------------------------
[program:postgres]
; Comando de arranque para PostgreSQL 13 en Debian
command=/usr/lib/postgresql/13/bin/postgres -D /var/lib/postgresql/data/main
user=postgres
autostart=true
autorestart=true
stopasgroup=true
environment=PGDATA="/var/lib/postgresql/data/main"
stdout_logfile=/app/logs/postgres.out.log
stderr_logfile=/app/logs/postgres.err.log

; --------------------------------------------------------------------------
; REDIS
; --------------------------------------------------------------------------
[program:redis]
command=/usr/bin/redis-server
autostart=true
autorestart=true
stopasgroup=true
stdout_logfile=/app/logs/redis.out.log
stderr_logfile=/app/logs/redis.err.log

; --------------------------------------------------------------------------
; API GATEWAY (Go) - REQUIERE formato HOST:PORT para Redis
; --------------------------------------------------------------------------
[program:api]
command=/app/api-gateway/api-bin
autostart=true
autorestart=true
startsecs=15
stopasgroup=true
stdout_logfile=/app/logs/api.out.log
stderr_logfile=/app/logs/api.err.log
; Formato GO: localhost:6379
environment=REDIS_URL="localhost:6379",PRODUCT_SERVICE_URL="http://localhost:8001",INVENTORY_SERVICE_URL="http://localhost:8002"

; --------------------------------------------------------------------------
; PRODUCT SERVICE (Python) - REQUIERE esquema redis://
; --------------------------------------------------------------------------
[program:product]
command=python3 /app/product-service/main.py
autostart=true
autorestart=true
startsecs=15
stopasgroup=true
stdout_logfile=/app/logs/product.out.log
stderr_logfile=/app/logs/product.err.log
; CORRECCIÓN: Volvemos a añadir 'redis://' ya que el cliente Python lo exige.
environment=DATABASE_URL="postgresql://admin:admin123@localhost:5432/microservices_db?sslmode=disable",REDIS_URL="redis://localhost:6379"

; --------------------------------------------------------------------------
; INVENTORY SERVICE (Go) - REQUIERE formato HOST:PORT para Redis
; --------------------------------------------------------------------------
[program:inventory]
command=/app/inventory-service/inventory-bin
autostart=true
autorestart=true
startsecs=30
stopasgroup=true
stdout_logfile=/app/logs/inventory.out.log
stderr_logfile=/app/logs/inventory.err.log
; Formato GO: localhost:6379
environment=DATABASE_URL="postgresql://admin:admin123@localhost:5432/microservices_db?sslmode=disable",REDIS_URL="localhost:6379"
